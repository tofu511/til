## 親子テーブル関係
- データ取得効率を高めるために行を物理的に同じ場所に配置したい場合、テーブル間に親子関係を定義できる

## 主キー
- 全てのテーブルには主キーが必要
- テーブルの親子関係を作る場合、親テーブルの主キー列が子テーブルの主キーの接頭辞になっている必要がある
- 主キーの値の順序で行を格納し、子の行を同じ主キーをもつ親の行の間に挿入する。この方法を**インターリーブ**と呼ぶ
  - 子テーブルはインターリーブされたテーブルと呼ぶ
  - イメージは[こちら](https://qiita.com/pa_pa_geno/items/c5fc5ea0d5daf415080d#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%AA%E3%83%BC%E3%83%96)

## データベースのスプリット
- テーブル間の親子関係は最大7層まで定義できる。要するに７個のテーブルの行を同じ場所に配置できる
- データベースが大規模になると、Spannerはデータを分割してスプリットと呼ばれるまとまりに分ける
- 各スプリットを他から独立して移動させ、異なる物理的場所にある異なるサーバーに割り当てることができる

## ホットスポット
- ホットスポットとは、あるテーブルの処理が特定のノードに集中すること。これが起きるとパフォーマンスの劣化が起きる

## ホットスポットを防ぐ主キーの選択方法
- 主キーがMySQLのauto_incrementのように単調増加 or 単調減少するとホットスポットが発生する
  - 常にテーブルの最後に追加されるため、ノードが固定されてしまうため
- 主キーのベストプラクティスは以下の通り
  - キーの順序を入れ替える
  - 一意キーのハッシュを作成して、論理シャード間に書き込みを分散する
  - Universally Unique Identifier（UUID）を使用する

## 参考資料
- https://cloud.google.com/spanner/docs/schema-and-data-model?hl=ja
- https://cloud.google.com/spanner/docs/schema-design?hl=ja
- https://qiita.com/pa_pa_geno/items/c5fc5ea0d5daf415080d
