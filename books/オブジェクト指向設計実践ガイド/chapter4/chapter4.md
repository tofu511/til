# 4章 柔軟なインターフェースをつくる
- 設計ではオブジェクトが何を知っているか(オブジェクトの責任)や、誰を知っているか(オブジェクトの依存関係)だけでなく、オブジェクト間で受け渡されるメッセージについても考慮しないといけない
- オブジェクト間の会話はオブジェクトのインターフェースを介して行われる

## インターフェースを定義する
### パブリックインターフェース
- パブリックなインターフェース(パブリックなメソッド)は以下の特性を備える
	- クラスの主要な責任を明らかにする
	- 外部から実行されることが想定される
	- 気まぐれに変更しない
	- 他者がそこに依存しても安全
	- テストで完全に文書化されている

### プライベートインターフェース
- プライベートなインターフェース(プライベートなメソッド)は以下の特性を備える
	- 実装の詳細に関わる
	- 他のオブジェクトから送られてくることは想定されていない
	- どんな理由でも変更されうる
	- 他者がそこに依存するのは危険
	- テストでは言及されてないこともある

## 責任、依存関係、そしてインターフェース
- クラスが単一の責任を持つということはクラスは単一の目的を果たすものとなる
- クラスのパブリックメソッドは責任の説明と解釈できるものであるべき
- パブリックインターフェースはクラスの責任を明確に述べるものである
- メソッドにパブリックやプライベートと印をつけることはクラスの使用者に対してどのメソッドは安全に依存できそうかを伝えていることになる
- 他のクラスのプライベートメソッドに依存するとは、本質的に不安定なものに依存していることになることを理解すること

## パブリックインターフェースを見つける
- アプリケーションにおいて、データと振る舞いを兼ね備えたものをドメインオブジェクトはアプリケーションを設計する上で中心となるものでは**ない**
- 熟練した設計者はオブジェクト間で交わされるメッセージに注意を向ける

### シーケンス図を使う
- オブジェクトとメッセージの実験するのにうってつけな方法が「シーケンス図」
- 視点を「このクラスが必要なのは知っているけど、何をすべきなのだろう」から「このメッセージを送る必要があるけれど、誰が応答すべきなんだろう」へ変えることが設計者としてのキャリアの転機になる

### 「どのように」を伝えるのではなく「何を」を頼む
- 送り手の望みを頼むメッセージと、受け手にどのように振る舞うかを伝えるメッセージの違いを理解することが、適切に定義されたパブリックインターフェースを持つ、再利用可能なクラスを作るための鍵となる
- 送り手は「どのように」を知る必要はない、「どのように」のやり方が変わったら、送り手側に修正が必要になってしまう
- 「どのように」はメッセージを受け取った側の責任であり、送り手は「何を」を頼めば良い

## 一番良い面(インターフェース)を表に出すコードを書く
- インターフェースこそが全てのテストよりも、他のどんなコードよりも、アプリケーションを定義し、その将来を決定づける

### 明示的なインターフェースを作る
- パブリックインターフェースに含まれるメソッドは以下のようにあるべき
	- 明示的にパブリックインターフェースだと特定できる
	- 「どのように」よりも、「何を」になっている
	- 名前は考えられる限り変わり得ないものである
	- オプション引数として、ハッシュをとる(Ruby)

### 他のパブリックインターフェースに敬意を払う
- 自分の設計が他のクラスのプライベートメソッドの使用を強制するものである場合、その設計を再考すべき
- プライベートインターフェースに依存すると変更が強制されるリスクが高まる

## デメテルの法則
- デメテルの法則(LoD: Law of Demeter)はオブジェクトを疎結合にするためのコーディング規則の集まり

### デメテルを定義する
- デメテルはメッセージを送ることができるオブジェクトの集合を制限する
	- 「直接の隣人のみに話しかけよう」とか「ドットは1つしか使わないようにしよう」なんて言われる
- 以下のようなコードはデメテルの法則に反している可能性がある

```ruby
# Tripのdepartメソッドに以下が含まれているとする
customer.bicycle.wheel.tire
customer.bicycle.wheel.rotate
hash.keys.sort.join(',')
```

### 法則を違反することによる影響
- wheelのtireやrotateが変更されると、Tripとwheelは無関係なのに変更を強制される恐れがある。不必要に変更コストをあげてしまい、「合理的」ではない
- tireやrotateの変更によってTripのdepartに影響が出るのは「見通しが良い」ものではない
- Tripを再利用するのにwheelとtireをもつbicycleを持つcustomerにアクセスできるようにする必要がある。かなりコンテキストを必要とするので「利用性が高い」とは言えない
- このコードが複製されると似たような問題を抱えるコードが再生産される。「模範的」なものではない。

### 違反を回避する
- 一般的な方法の一つに委譲を使いドットを避ける方法がある
- メッセージを委譲するとは、他のオブジェクトにメッセージを渡すことである。これはしばしばラッパーメソッドを介して行われる
- 見た目の解消にはなるが、コードの結合を解決したことにはならない場合もある

### デメテルに耳を傾ける
- メッセージチェーンが長くなってしまうのは、「どのように」を知りすぎているために発生する。
- (上のコードを例にすると) departがcustomerに「何を」求めているかから決めれば良い
	- `customer.ride` とすれば良い
- そのオブジェクトは何のオブジェクトなのかを考える

