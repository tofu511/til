## IAMポリシーについて
- 誰が、どのAWSサービスの、どのリソースに対して、どんな操作を、許可するかしないか ということをJSON形式で記述する
- 作ったポリシーをIAMユーザー、IAMグループ、IAMロールやAWSリソースに関連づけることでアクセス制御を実現する
- `AmazonS3ReadOnlyAccess`の例
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:Get*",
        "s3:List*"
      ],
      "Resource": "*"
    }
  ]
}
```

## ポリシータイプ
- アイデンティティ(ユーザー、ユーザーグループ、ロール)ベースのポリシー
  - その名の通りアイデンティティ(ユーザー、ユーザーグループ、ロール)にアタッチできるポリシー
  - エンティティ(ユーザーまたはロール)が実行できるアクション、リソース、条件を制御する
  - JSONでいうところの`Principal`は記述しない(Principalが操作の主体で、操作の主体にポリシーをアタッチするので)
  - さらに分類できる
    - 管理ポリシー
      - AWSアカウント内の複数のユーザー、グループ、ロールにアタッチできる独立したポリシー
      - 2種類ある
        - AWS管理ポリシー
          - AWSが作成、管理する管理ポリシー
        - カスタマー管理ポリシー
          - AWSアカウントで作成、管理する管理ポリシー
    - インラインポリシー
      - お客さんが作成、管理するポリシーで単一のユーザー、グループ、ロールに直接埋め込まれる。通常使用しない方が良い
- リソースベースのポリシー
  - Amazon S3バケットなどのリソースにアタッチするJSONポリシードキュメントのこと
  - リソースに対してアクションを実行するプリンシパルのアクセス許可と一緒に条件を定義する
  - リソースベースのポリシーは全てインラインポリシー

## JSONポリシーの概要
- 以下の要素から成る
  - ドキュメント上部のポリシー概要(オプション)
  - 1つ以上の個別ステートメント
    - バージョン(Version)
      - ポリシー言語のバージョンを指定する。`2012-10-17`を基本的に使用する。
    - ステートメント(Statement)
      - メイン要素
      - ポリシーには複数のステートメントを含めることができる
    - Sid
      - 複数ステートメントを識別するためのステートメントID
    - 効果(Effect)
      - AllowもしくはDenyでポリシーで付与もしくは拒否するアクセス許可を指定する 
    - プリンシパル(Principal)
      - アクセス許可を付与もしくは拒否するアカウント、ユーザー、ロールを指定する
      - ユーザー、ロールにアタッチするポリシーを作る場合は含めない
    - アクション(Action)
      - ポリシーで許可もしくは拒否するアクションのリスト
    - リソース(Resource)
      - アクションを適用するリソースのリスト  
    - 条件(Condition)
      - アクセス許可を付与する条件
- 例
```json
{
  "Version": "2012-10-17",
  "Id": "S3-Account-Permissions",
  "Statement": [{
    "Sid": "1",
    "Effect": "Allow",
    "Principal": {"AWS": ["arn:aws:iam::ACCOUNT-ID-WITHOUT-HYPHENS:root"]},
    "Action": "s3:*",
    "Resource": [
      "arn:aws:s3:::mybucket",
      "arn:aws:s3:::mybucket/*"
    ]
  }]
}
```

## 参考資料
- [AWS IAMポリシーを理解する](https://dev.classmethod.jp/cloud/aws-iam-policy/)
- [ポリシーとアクセス許可](https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/access_policies.html)
